<!DOCTYPE html>
<html lang="fr">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Un petit script pour récupérer les URLs des sites web hébergés sur la même adresse IP | crowd42's blog</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/css/bootstrap-3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file// -->
    <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

    


    <link rel="shortcut icon" href="/images/favicon.ico">

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="feed/"> 

</head>


    <body>
      <div class="container">

        <header class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <h1 class="">crowd42's blog</h1>
    <p>
    <span class="reserved">char</span> nick[<span class="number">7</span>] = <span class="string">"crowd42"</span>;
    </p>
    <p>
    printf(<a href="https://github.com/crowd42" target="_blank"><span class="string">"https://github.com/<span class="reserved">%s\n</span>"</span></a>,nick);
    </p>

    <p>
    printf(<a href="https://mastodon.social/crowd42"
      target="_blank"><span class="string">"https://mastodon.social/<span class="reserved">%s\n</span>"</span></a>,nick);
    </p>

    <p>
    printf(<a href="https://keybase.io/crowd42"
      target="_blank"><span class="string">"https://keybase.io/<span class="reserved">%s\n</span>"</span></a>,nick);
    </p>


     <p>
    printf(<a href="https://twitter.com/crowd42"
      target="_blank"><span class="string">"https://twitter.com/<span class="reserved">%s\n</span>"</span></a>,nick);
    </p>

    <p>
    printf(<span class="string">"<span class="reserved">%s\x40</span>riseup<span class="reserved">\x2e\\\b</span>net<span class="reserved">\n</span>"</span>,nick);
    </p>
    <!-- <p>
            printf(<a href="https://crowd42.github.io" target="_blank"><span class="string">"https://<span class="reserved">%s</span>.github.io<span class="reserved">\n</span>"</span></a>,nick);
        </p> -->
    <p>
    puts(<a href="misc/pubkey.gpg.txt" target="_blank"><span
        class="string">"0xdc 5a6d b445 976d 60"</span></a>);
    </p>
  </div>
</header>

<div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <div class="menu">
      <ul>
          <li><a href="/">home</a></li>
          <li><a href="/blog/">blog</a></li>
          <li> <a href="/astuces/">astuces</a></li>
          <li><a href="/books/">books</a></li>
          <li><a href="/casts">*casts</a></li>
          <li><a href="/movies">movies</a></li>
          <li><a href="/talks">talks</a></li>
          <li><a href="/zines">*zines</a></li>
          <li><a href="/ressources">ressources</a></li>
          <li><a href="/feed">feed</a></li>
          <li><a href="https://liberapay.com/~29921/donate">donate</a></li>
      </ul>
    </div>
  </div>
</div>



        <div class="row">
          <div class="col-lg-8 col-lg-offset-2">
            <main>
            <div class="post">

  <header class="post-header">
    <h1>Un petit script pour récupérer les URLs des sites web hébergés sur la même adresse IP</h1>
  </header>

  <article class="post-content">
  <div class="post">

  <header class="post-header">
    <p class="meta">
        Jan 16, 2018
        
        
        •
        <span><a href="/category/#infosec" class="reserved">infosec</a>,</span><span><a href="/category/#python" class="reserved">python</a>,</span><span><a href="/category/#bing" class="reserved">bing</a>,</span><span><a href="/category/#osint" class="reserved">osint</a>,</span><span><a href="/category/#pentest" class="reserved">pentest</a></span>
    </p>
  </header>

  <article class="post-content">
  <p>Dans un de mes derniers articles (<a href="https://crowd42.github.io/comment-jai-pu-gagner-acces-administrateur-serveur-windows-grace-google/">Comment j’ai pu gagner un accès administrateur sur un serveur Windows 2012 grâce à Google [0]</a>), j’ai évoqué comment j’ai utilisé le moteur de recherche de Microsoft afin de trouver les sites web qui sont hébergés sur le même serveur web d’un client lors d’un test d’intrusion.</p>

<p>Pour ceux qui ont la flemme d’aller jeter un coup d’œil à l’article en question, on peut obtenir ces sites web en laçant la requête suivante :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip: 93.184.216.34 (l'adresse IP du site example.com)
</code></pre></div></div>

<p>Dans les cas où les résultats ne dépassent pas cinq voire même un peu plus, ça reste gérable, on peut copier et coller les urls dans un fichier pour les utiliser plus tard. Cependant, si on est face à plus d’une dizaine d’urls, le copier/coller devient beaucoup moins pratique et très fatiguant. C’est la raison pour laquelle j’avais écrit un script python pour automatiser cette tâche.</p>

<p>C’est un script python très banal et je suis quasiment certain que si j’avais pris le temps de le chercher sur le web, j’aurais surement trouvé une meilleure version que la mienne, mais voilà, j’en avais besoin et je l’ai écrit.</p>

<p>Pour utiliser ce script vous aurez besoin de vous enregistrer sur le site des <a href="https://azure.microsoft.com/en-us/services/cognitive-services/bing-web-search-api/">services Azure de Microsoft [1]</a> pour obtenir votre clé API (je pense que je vais réaliser une deuxième version de ce script en utilisant <a href="https://github.com/requests/requests">requests [2]</a> et <a href="https://www.crummy.com/software/BeautifulSoup/#HallOfFame">BeautifulSoup [3]</a> afin d’éviter l’inscription chez Microsoft).</p>

<p>Son utilisation est très simple :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>usage: ip_bing.py [-h] [-i IP] [-c COUNT] [-f FILE] [-o OFFSET]

Find websites hosted on the same IP address

optional arguments:
  -h, --help            show this help message and exit
  -i IP, --ip IP        The IP address of the web server
  -c COUNT, --count COUNT
                        Number of results to return
  -f FILE, --file FILE  Save the output into a text file
  -o OFFSET, --offset OFFSET
                        start in results number x, default: 0
</code></pre></div></div>

<p>Par défaut le script ne va afficher que les dix premièrs résultats :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python ip_bing.py -i  93.184.216.34
</code></pre></div></div>

<p>Pour obtenir plus de résultat utilisez l’argument -c (–count) :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python ip_bing.py -i  93.184.216.34 -c 40
</code></pre></div></div>

<p>Avec cette commande, vous obtiendrez les premiers 40 résultats, à condition bien évidemment que le moteur de recherche trouve 40 résultats ou plus.</p>

<p>Vous pouvez aussi spécifier la page par laquelle vous souhaitez commencer :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python ip_bing.py -i  93.184.216.34 -c 20 -o 30
</code></pre></div></div>

<p>Dans l’exemple ci-dessus ip_bing va récupérer les vingts premiers résultat mais à partir de la quatrième page.</p>

<p>Enfin pour sauvegardé les urls dans un fichier ajouter l’argument -f à votre commande :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python ip_bing.py -i  93.184.216.34 -c 20 -o 30 -f urls_example_com.txt
</code></pre></div></div>

<p>Voilà ci-dessous le script en question, faites en ce que vous voulez :-)</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#!/usr/bin/env python
# -*- coding: utf-8 -*-
</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="c1"># ip_bing take 3 arguments, the last two are optional
</span><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="s">"Find websites hosted on the same IP address"</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-i'</span><span class="p">,</span> <span class="s">'--ip'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"The IP address of the web server"</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-c'</span><span class="p">,</span> <span class="s">'--count'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Number of results to return'</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-f'</span><span class="p">,</span> <span class="s">'--file'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Save the output into a text file'</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s">'-o'</span><span class="p">,</span>
    <span class="s">'--offset'</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s">'start in results number x, default: 0'</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">.</span><span class="n">ip</span><span class="p">:</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">print_help</span><span class="p">()</span>
    <span class="nb">exit</span><span class="p">()</span>
<span class="c1"># Subscription key which provides access to this API.
</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Ocp-Apim-Subscription-Key'</span><span class="p">:</span> <span class="s">'PASE_YOUR_KEY_HERE'</span><span class="p">}</span>

<span class="c1"># Request URL
</span><span class="n">url</span> <span class="o">=</span> <span class="s">"https://api.cognitive.microsoft.com/bing/v7.0/search"</span>

<span class="c1"># The keyword (dork) to pass to bing
</span><span class="n">keyword</span> <span class="o">=</span> <span class="s">'ip:'</span> <span class="o">+</span> <span class="n">args</span><span class="p">.</span><span class="n">ip</span>
<span class="n">payloads</span> <span class="o">=</span> <span class="p">{</span><span class="s">'q'</span><span class="p">:</span> <span class="n">keyword</span><span class="p">,</span> <span class="s">'count'</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">count</span><span class="p">,</span> <span class="s">'offset'</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">offset</span><span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">payloads</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

<span class="c1"># Get the response as json content
</span><span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s">'webPages'</span><span class="p">][</span><span class="s">'value'</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">'url'</span><span class="p">])</span>
    <span class="c1"># We also the save output as file in the current directory, so we can use
</span>    <span class="c1"># later with other programs for example
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="nb">file</span><span class="p">,</span> <span class="s">'a'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">'url'</span><span class="p">]</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">TypeError</span><span class="p">:</span>
        <span class="k">pass</span></code></pre></figure>

<h3 id="liens">Liens</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[0]: https://crowd42.github.io/comment-jai-pu-gagner-acces-administrateur-serveur-windows-grace-google/
[1]: https://azure.microsoft.com/en-us/services/cognitive-services/bing-web-search-api/
[2]: https://github.com/requests/requests
[3]: https://www.crummy.com/software/BeautifulSoup/#HallOfFame
</code></pre></div></div>

  </article>
   

    
    
        
            
        
            
                
                <h1>Sur le même sujet</h1>
                <ul>
                
                <li>
                    <a href="http://localhost:4000/blog/liste-podcasts-python/">Une liste des podcasts python
                    
                    </a>
                </li>
                
                
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
                
                <li>
                    <a href="http://localhost:4000/blog/microsoft-mots-de-passe-toute-une-histoire/">Microsoft et les mots de passe, toute une histoire
                    
                    </a>
                </li>
                
                
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
                
                <li>
                    <a href="http://localhost:4000/blog/windows-credential-guard-mimikatz/">Windows Credential Guard et Mimikatz
                    
                    </a>
                </li>
                
                
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
                
                <li>
                    <a href="http://localhost:4000/blog/meltdown-spectre/">Deux points qui me tracassent à propos de meltdown et spectre
                    
                    </a>
                </li>
                
                
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
                
                <li>
                    <a href="http://localhost:4000/blog/full-disclosure-etihad-airways/">Full Disclosure : Des emails et mots de passe de la compagnie aérienne Etihad Airways dans l'air
                    
                    </a>
                </li>
                
                
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
                
                <li>
                    <a href="http://localhost:4000/comment-jai-pu-gagner-acces-administrateur-serveur-windows-grace-google/">Comment j'ai pu gagner un accès administrateur sur un serveur Windows 2012 grâce à Google
                    
                    </a>
                </li>
                
                
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    


    </ul>


	<p class="feed-recomendation">
		Si vous avez aimé ce billet, vous pouvez vous inscrire au <a href="feed/">flux RSS</a> !
	</p>

  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'crowd42s-blog-1';
    var disqus_config = function () {
        this.page.identifier = "/-blog/script-python-sites-web-meme-adresse-ip/";
    };
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




</div>

  </article>

</div>

            </main>
          </div>
        </div>

        <div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <footer>
      Propulsé fièrement par Jekyll!
    </footer>
  </div>
</div>


      </div>
    </body>
</html>
